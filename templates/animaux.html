<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accueil</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" href="../static/images/logo2.png" type="image/x-icon">
</head>

<body class="w-full h-screen bg-[#EDE3E3]">

    {% include '/components/nav.html' %}

    <div class="w-full px-10 py-6 space-y-8">

        {% if current_user.role == 'admin' or current_user.role == 'soigneur' %}
        <button
            onclick="openAddModal()"
            class="px-4 py-2 rounded-lg bg-green-500 hover:bg-green-600 text-white">
            ➕ Ajouter un animal
        </button>
        {% endif %}

        <!-- CARTES ANIMAUX -->
        {% for animau in animaux %}
        <div id="animal-{{ animau.id }}" class="animal-card bg-[#DEDEDE] rounded-xl shadow flex items-center p-6 relative">
            
            <!-- Image -->
            <div class="w-32 h-32 bg-[#262626] rounded-xl flex items-center justify-center">
                <img src="../static/uploads/{{ animau.image }}" alt="photo animal" width="128" height="128" class="object-cover rounded-xl">
            </div>

            <!-- Informations -->
            <div class="ml-6 space-y-3">
                <p>
                    <span class="font-semibold">NOM :</span>
                    <span class="text-gray-800">{{ animau.nom }}</span>
                </p>

                <p>
                    <span class="font-semibold">ARRIVÉE :</span> {{ animau.arrive }}
                    <span class="font-semibold ml-4">DÉPART :</span> {{ animau.depart if animau.depart else 'N/A' }}
                </p>

                <p>
                    <span class="font-semibold">RACE :</span>
                    <span class="text-gray-800">{{ animau.espèce }}</span>

                    <span class="font-semibold">ENCLÔT :</span>
                    <span class="text-gray-800">{{ animau.enclot if animau.enclot else 'N/A' }}</span>
                </p>
            </div>

            <!-- Boutons -->
            {% if current_user.role in ['admin', 'soigneur'] %}
            <div class="absolute bottom-6 right-6 flex space-x-3">
                <button
                    onclick="openModal('{{ animau.nom }}', '{{ animau.arrive }}', '{{ animau.espèce }}', '{{ animau.enclot }}', '{{ animau.depart }}', '{{ animau.id }}')"
                    class="bg-green-400 hover:bg-green-500 transition text-white font-semibold px-6 py-2 rounded-lg">
                    MODIFIER
                </button>

                <button
                    onclick="deleteAnimal('{{ animau.id }}')"
                    class="bg-red-500 hover:bg-red-600 transition text-white font-semibold px-6 py-2 rounded-lg">
                    SUPPRIMER
                </button>
            </div>
            {% endif %}
        </div>
        {% endfor %}

    </div>

    <!-- MODAL MODIFICATION -->
    <div id="editModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-xl w-[350px]">
            <h2 class="text-xl font-bold mb-4">Modifier l'animal</h2>
            <form id="editForm" class="space-y-4" method="POST">
                <div>
                    <label class="block font-semibold">Nom :</label>
                    <input id="modal-nom" name="nom" type="text" class="w-full border rounded-lg px-3 py-2">
                </div>

                <div>
                    <label class="block font-semibold">Arrivée :</label>
                    <input id="modal-arrivee" name="arrive" type="date" class="w-full border rounded-lg px-3 py-2">
                </div>

                <div>
                    <label class="block font-semibold">Départ :</label>
                    <input id="modal-depart" name="depart" type="date" class="w-full border rounded-lg px-3 py-2">
                </div>

                <div>
                    <label class="block font-semibold">Race :</label>
                    <input id="modal-race" name="race" type="text" class="w-full border rounded-lg px-3 py-2">
                </div>

                <div>
                    <label class="block font-semibold">Enclôt :</label>
                    <input id="modal-enclot" name="enclot" type="text" class="w-full border rounded-lg px-3 py-2">
                </div>

                <div class="flex justify-between pt-2">
                    <button type="button" onclick="closeModal()" class="px-4 py-2 rounded-lg bg-gray-300 hover:bg-gray-400">
                        Annuler
                    </button>
                    <button type="submit" class="px-4 py-2 rounded-lg bg-green-500 hover:bg-green-600 text-white">
                        Enregistrer
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL AJOUT ANIMAL -->
    <div id="addModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-xl w-[350px]">
            <h2 class="text-xl font-bold mb-4">Ajouter un animal</h2>
            <form method="POST" action="/api/addanimal" class="space-y-4" enctype="multipart/form-data">

                <div>
                    <label class="block font-semibold">Nom :</label>
                    <input name="nom" id="add-nom" type="text" class="w-full border rounded-lg px-3 py-2" placeholder="Ex : Simba" required>
                </div>

                <div>
                    <label class="block font-semibold">Arrivée :</label>
                    <input name="arrive" id="add-arrivee" type="date" class="w-full border rounded-lg px-3 py-2" required>
                </div>

                <div>
                    <label class="block font-semibold">Départ (optionnel) :</label>
                    <input name="depart" id="add-depart" type="date" class="w-full border rounded-lg px-3 py-2">
                </div>

                <div>
                    <label class="block font-semibold">Enclôt :</label>
                    <input name="enclot" id="add-enclot" type="text" class="w-full border rounded-lg px-3 py-2">
                </div>

                <div>
                    <label class="block font-semibold">Race :</label>
                    <input name="race" id="add-race" type="text" class="w-full border rounded-lg px-3 py-2" placeholder="Ex : Tigre" required>
                </div>

                <div>
                    <label class="block font-semibold">Photo :</label>
                    <input name="file" id="add-file" type="file" class="w-full border rounded-lg px-3 py-2 mb-2" accept="image/*" required>
                </div>

                <div class="flex justify-between pt-2">
                    <button type="button" onclick="closeAddModal()" class="px-4 py-2 rounded-lg bg-gray-300 hover:bg-gray-400">
                        Annuler
                    </button>
                    <button type="submit" class="px-4 py-2 rounded-lg bg-blue-500 hover:bg-blue-600 text-white">
                        Ajouter
                    </button>
                </div>
            </form>
        </div>
    </div>

    {% include '/components/flash.html' %}

    <!-- SCRIPTS -->
    <script>
        function openModal(nom, arrivee, race, enclot, depart, id) {
            const modal = document.getElementById("editModal");
            modal.classList.remove("hidden");
            modal.classList.add("flex");

            document.getElementById("modal-nom").value = nom;
            document.getElementById("modal-arrivee").value = arrivee;
            document.getElementById("modal-race").value = race;
            document.getElementById("modal-enclot").value = enclot;
            document.getElementById("modal-depart").value = depart || "";

            document.getElementById("editForm").action = `/api/editanimal/${id}`;
        }

        function closeModal() {
            const modal = document.getElementById("editModal");
            modal.classList.add("hidden");
            modal.classList.remove("flex");
        }

        function openAddModal() {
            document.getElementById("addModal").classList.remove("hidden");
            document.getElementById("addModal").classList.add("flex");
        }

        function closeAddModal() {
            document.getElementById("addModal").classList.add("hidden");
            document.getElementById("addModal").classList.remove("flex");
        }

        async function deleteAnimal(id) {
            fetch(`/api/deleteanimal/${id}`, {
                method: 'DELETE'
            });
        }
    </script>

</body>
</html>
