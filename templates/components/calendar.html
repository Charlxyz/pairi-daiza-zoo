<script>
document.addEventListener("DOMContentLoaded", function () {
  const calendarEl = document.getElementById("calendar");

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: "dayGridMonth",

    events: "/api/events",

    selectable: true,
    select: function (info) {
      const title = prompt("Titre de l'événement :");
      if (!title) return;

      const startDate = prompt("Date de début (YYYY-MM-DD) :", info.startStr.split("T")[0]);
      if (!startDate) return;

      const startTime = prompt("Heure de début (HH:MM) :", "09:00");

      const endDate = prompt("Date de fin (YYYY-MM-DD) :", info.endStr.split("T")[0]);
      if (!endDate) return;

      const endTime = prompt("Heure de fin (HH:MM) :", "10:00");

      const description = prompt("Description :");

      const start = startDate + "T" + (startTime || "00:00");
      const end = endDate + "T" + (endTime || "00:00");

      fetch("/api/addevents", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          title: title,
          start: start,
          end: end,
          description: description
        })
      })
      .then(res => res.json())
      .then(() => window.location.href = "/events");
    },

    // -------------------------------------------
    // SUPPRESSION AVEC RECHARGEMENT DE LA PAGE
    // -------------------------------------------
    eventClick: function(info) {
      if (!confirm("Voulez-vous vraiment supprimer cet événement ?")) return;

      fetch("/deletevents", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({
          event_ids: info.event.id
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === "success") {
          window.location.reload();  // recharge pour mettre à jour l'affichage
        } else {
          alert("Erreur : " + data.message);
        }
      });
    }
  });

  calendar.render();
});
</script>
